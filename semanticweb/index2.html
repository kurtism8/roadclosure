<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="appname">
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Road Closures</title>
    <style>
        html, body, #map-canvas {
            height: 100%;
            margin: 0px;
            padding: 0px;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular.js"></script>
    <script>
        var appname = angular.module('appname', []);
        appname.controller('appCtrl', 
          function ($scope, $http) {
              var mapOptions = {
                  zoom: 13,
                  center: new google.maps.LatLng(43.4500, -80.4833),
                  mapTypeId: google.maps.MapTypeId.ROADMAP
              };

              $scope.map = new google.maps.Map(document.getElementById('map-canvas'),
                  mapOptions);
              $scope.getJobs = function () {
                  $http.get('jobs.cshtml?location=' + $scope.location + 
                      "&term=" + $scope.term).
                    success(function (data, status, headers, config) {
                        // this callback will be called asynchronously
                        // when the response is available
                        var x2js = new X2JS();
                        var roads = x2js.xml_str2json(data);
                        $scope.model = roads;
                        $scope.a = roads.roadclosures.roadclosure;
                        for (var i = 0; i < $scope.a.length; i++) {
                            //gets the location of intersections
                            var location = $scope.a[i].street[0] + " and " + $scope.a[i].fromstreet;
                            var location2 = $scope.a[i].street[0] + " and " + $scope.a[i].tostreet;

                            $http.get("https://maps.googleapis.com/maps/api/geocode/json?address=" + location + ", Kitchener, ON N2G, Canada")
                            .success(jQuery.proxy(function (data) {
                                this.from = data.results[0].geometry.location;

                            }, $scope.a[i]
                            ));

                            $http.get("https://maps.googleapis.com/maps/api/geocode/json?address=" + location2 + ", Kitchener, ON N2G, Canada")
                            .success(jQuery.proxy(function (data) {
                                this.to = data.results[0].geometry.location;

                                console.log(this);

                                var flightPlanCoordinates = [
                                new google.maps.LatLng(this.from.lat, this.from.lng),
                                new google.maps.LatLng(this.to.lat, this.to.lng)

                                ];

                                var flightPath = new google.maps.Polyline({
                                    path: flightPlanCoordinates,
                                    geodesic: true,
                                    strokeColor: '#FF0000',
                                    strokeOpacity: 1.0,
                                    strokeWeight: 2
                                });

                                flightPath.setMap($scope.map);

                            }, $scope.a[i])
                            );
                        }
                    }).
                    error(function (data, status, headers, config) {
                        // called asynchronously if an error occurs
                        // or server returns response with an error status.
                    });
              }
              $scope.getJobs();
             
          });
    </script>
</head>
<body ng-controller="appCtrl">
    
    
    <p>Title: Road Closures</p>    
    

        <div id="map-canvas"></div>
        

    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://x2js.googlecode.com/hg/xml2json.js"></script>

</body>
</html>
